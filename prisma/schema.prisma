generator client {
  provider = "prisma-client-js"
  previewFeatures = ["postgresqlExtensions"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  extensions = [vector]
}

model owner {
  id                String     @id @default(uuid())
  email             String?     @unique
  name              String?
  userId            String
  stripeId          String?
  subscription      billings? @relation("OwnerToBilling")
  stores            store[]
  orders            order[] 


  createdAt        DateTime @default(now())
  updatedAt         DateTime @updatedAt
}

model billings {
  id              String @id @default(uuid())
  amount          Int @default(10)
  plan            plans   @default(STANDARD)
  owner           owner?   @relation("OwnerToBilling", fields: [ownerId], references: [id])
  ownerId         String @unique
  userId          String @unique
  expiryDate      String?
  subscribed      Boolean @default(false)
  daysWithService Int     @default(0)
}

enum plans {
  STANDARD
  PRO
  ULTIMATE
}

model store {
  id                  String    @id @default(uuid())
  name                String
  owner               owner     @relation( fields: [ownerId], references: [id])
  ownerId             String    @unique
  userId              String    @unique
  subdomain           String    @unique
  products            product[]
  orders              order[] 

  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
}

model product {
  id          String @id @default(uuid())
  name          String
  priceInCents  Int
  imagePath     String
  description String @default("")
  isAvailableForPurchase     Boolean @default(true)
  discountCodes discount[]

  orderItems  orderItem[]
  storeId     String
  store       store @relation(fields: [storeId], references: [id])

  embedding   Unsupported("vector(1536)")? //https://github.com/prisma/prisma/discussions/18220
  tokens      Int?

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model discount {
  id             String           @id @default(uuid())
  code           String           @unique
  discountAmount Int
  discountType   discountCodeType
  uses           Int              @default(0)
  isActive       Boolean          @default(true)
  allProducts    Boolean          @default(false)
  createdAt      DateTime         @default(now())
  limit          Int?
  expiresAt      DateTime?
  storeId        String?

  products       product[]
  orders          order[]
}

enum discountCodeType {
  PERCENTAGE
  FIXED
}

model order{
  id String @id @default(uuid())
  storeId String
  store store @relation(fields: [storeId], references: [id])
  owner  owner     @relation(fields: [ownerId], references: [id])
  ownerId   String
  orderItems orderItem[]
  isPaid Boolean @default(false)
  phone String @default("")
  address String @default("")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  discountCodeId String?
  discountCode   discount? @relation(fields: [discountCodeId], references: [id], onDelete: Restrict)

  @@index([storeId])
}


model orderItem {
  id String @id @default(uuid())
  orderId String
  order order @relation(fields: [orderId], references: [id])
  productId String
  product product @relation(fields: [productId], references: [id])

  @@index([orderId])
  @@index([productId])
}
